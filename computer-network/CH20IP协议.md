# CH20IPåè®®

# è€ƒç‚¹

### ç¬¬20ç«  *IP*åè®®

1. IP*åˆ†ç»„ï¼ˆæ•°æ®æŠ¥ï¼‰çš„æ ¼å¼*
1. *åˆ†ç‰‡(Identification*ã€*Flags*ã€*Fragmentation offset*ï¼‰ã€ä½•å¤„åˆ†ç‰‡å’Œé‡è£…
1. MTU
1. IPv6åˆ†ç»„æ ¼å¼
1. IPv4åˆ°IPv6çš„è¿‡æ¸¡

## ç½‘é™…äº’è”

ç½‘ç»œçš„ç‰©ç†å±‚å’Œæ•°æ®é“¾è·¯å±‚åœ¨æœ¬åœ°è¿è¡Œã€‚è¿™ä¸¤å±‚å…±åŒè´Ÿè´£ç½‘ç»œç›¸é‚»èŠ‚ç‚¹é—´çš„æ•°æ®ä¼ é€’ã€‚

![image-20211225213850929](https://cdn.jsdelivr.net/gh/xinwuyun/pictures@main/2021/12/25/afee6dea988281415d39e0e0d41c2f9d-image-20211225213850929-83527e.png)

è¿™ä¸ªäº’è”ç½‘ç”±äº”ä¸ªç½‘ç»œç»„æˆï¼šå››ä¸ªLANä¸€ä¸ªWANã€‚

Aå‘é€æ•°æ®åˆ†ç»„åˆ°Déœ€è¦ç»è¿‡ä¸‰ä¸ªé“¾è·¯ï¼Œæ¯ä¸ªé“¾è·¯åŒ…æ‹¬ä¸¤ä¸ªç‰©ç†å±‚å’Œæ•°æ®é“¾è·¯å±‚

> S1å¦‚ä½•çŸ¥é“åº”è¯¥ä»f3æ¥å£å‘é€å‡ºå»ï¼Œå‰ä¸¤å±‚æ²¡æœ‰è§„åˆ™å¸®åŠ©R1åšå‡ºæ­£ç¡®å†³ç­–ã€‚è€Œä¸”ï¼Œ**å¸§ä¹Ÿæ²¡æœ‰æºå¸¦ä»»ä½•è·¯ç”±é€‰æ‹©ä¿¡æ¯**ã€‚å¸§ä¸­åªåŒ…å«ä¸»æœºAçš„MACåœ°å€å’ŒS1çš„MACåœ°å€

## ç½‘ç»œå±‚éœ€æ±‚

ç½‘ç»œå±‚è´Ÿè´£

1. ä¸»æœºé—´çš„ä¼ é€’
2. é€šè¿‡è·¯ç”±å™¨æˆ–äº¤æ¢æœºå¯¹åˆ†ç»„è¿›è¡Œ**è·¯ç”±é€‰æ‹©**

## ç½‘ç»œå±‚æ€»çš„æ€æƒ³

**æºç«¯ç½‘ç»œå±‚**ï¼šå°†æ¥è‡ªå¦ä¸€ä¸ªåè®®çš„è¾“å…¥æ•°æ®ç”Ÿæˆä¸€ä¸ªåˆ†ç»„ï¼Œåˆ†ç»„çš„å¤´éƒ¨åŒ…å«æºå’Œç›®çš„é€»è¾‘åœ°å€ä»¥åŠå…¶ä»–ä¿¡æ¯ã€‚ç½‘ç»œå±‚è´Ÿè´£æ£€éªŒè·¯ç”±è¡¨å¯»æ‰¾è·¯ç”±é€‰æ‹©ä¿¡æ¯ã€‚å¦‚æœåˆ†ç»„å¤ªå¤§ï¼Œå°±è¦åˆ†æ®µã€‚

**äº¤æ¢æœºæˆ–è·¯ç”±å™¨ä¸­çš„ç½‘ç»œå±‚ï¼š**å½“ä¸€ä¸ªåˆ†ç»„åˆ°è¾¾æ—¶ï¼Œè·¯ç”±å™¨æˆ–äº¤æ¢æœºå°±ä»ä»–çš„è·¯ç”±é€‰æ‹©è¡¨ä¸­æ‰¾åˆ°ä¸€ä¸ªå¿…é¡»å°†å…¶å‘é€å‡ºå»çš„æ¥å£ã€‚**æ”¹å˜å¤´éƒ¨çš„æŸäº›å†…å®¹åçš„**åˆ†ç»„æŒ‰ç…§è·¯ç”±é€‰æ‹©ä¿¡æ¯å†ä¼ é€ç»™æ•°æ®é“¾è·¯å±‚

**ç›®çš„ç«¯çš„ç½‘ç»œå±‚è´Ÿè´£åœ°å€éªŒè¯**ï¼šç¡®ä¿åˆ†ç»„ç»„ä¸­çš„ç›®çš„åœ°å€ä¸ä¸»æœºåœ°å€æ˜¯ç›¸åŒçš„ã€‚*å¦‚æœåˆ†ç»„æ˜¯ä¸€ä¸ªåˆ†æ®µï¼Œç½‘ç»œå±‚å°±ç­‰å¾…æ‰€æœ‰çš„åˆ†æ®µåˆ°è¾¾åå†å¯¹å…¶è¿›è¡Œé‡ç»„*ï¼Œç„¶åå†å°†é‡ç»„åçš„åˆ†ç»„äº¤ç»™ä¼ è¾“å±‚ã€‚

![image-20211225214753748](https://cdn.jsdelivr.net/gh/xinwuyun/pictures@main/2021/12/25/82e5c7215b0d79804c1f8aaf068d3b91-image-20211225214753748-1a3da5.png)

![image-20211226103500119](https://cdn.jsdelivr.net/gh/xinwuyun/pictures@main/2021/12/26/c3ba92ef40f0bf79c35036c8610156f0-image-20211226103500119-7f6c05.png)

## ä½œä¸ºæ•°æ®æŠ¥ç½‘ç»œçš„å› ç‰¹ç½‘

äº¤æ¢å¯ä»¥åˆ†ä¸º

1. ç”µè·¯äº¤æ¢
2. åˆ†ç»„äº¤æ¢
   1. è™šç”µè·¯æ–¹æ³•
   2. æ•°æ®æŠ¥æ–¹æ³•
3. æŠ¥æ–‡äº¤æ¢

åœ¨ç½‘ç»œå±‚ï¼Œå› ç‰¹ç½‘ä½¿ç”¨æ•°æ®æŠ¥äº¤æ¢æ–¹æ³•ã€‚å®ƒåˆ©ç”¨ç½‘ç»œå±‚æ‰€å®šä¹‰çš„å…¨çƒåœ°å€ï¼Œä»æºç«¯åˆ°ç›®çš„ç«¯è·¯ç”±åˆ†ç»„

> å› ç‰¹ç½‘çš„ç½‘ç»œå±‚äº¤æ¢æ˜¯åˆ©ç”¨æ•°æ®æŠ¥åˆ†ç»„äº¤æ¢çš„æ–¹æ³•å®ç°çš„

### **ä½œä¸ºæ— è¿æ¥ç½‘ç»œçš„å› ç‰¹ç½‘**

#### é¢å‘è¿æ¥çš„æœåŠ¡

1. æºç«¯é¦–å…ˆä¸ç›®çš„ç«¯å»ºç«‹ä¸€ä¸ªè¿æ¥
2. è¿æ¥å»ºç«‹ï¼Œåˆ†ç»„æŒ‰ç…§é¡ºåºä¾æ¬¡æ²¿ç€ç›¸åŒçš„è·¯å¾„å‘é€
3. æ‰€æœ‰æŠ¥æ–‡çš„æ‰€æœ‰åˆ†ç»„ä¼ é€’å®Œæ¯•ï¼Œè¿æ¥ç»ˆæ­¢

ä¸€ä¸ªè¿æ¥å»ºç«‹åï¼Œå¯¹å…·æœ‰ç›¸åŒæºå’Œç›®çš„åœ°å€çš„åˆ†ç»„åºåˆ—ï¼Œåªä¼šè¿›è¡Œä¸€æ¬¡è·¯ç”±ç­–ç•¥ã€‚

#### è¿æ¥æœåŠ¡

1. ç½‘ç»œå±‚åè®®ç‹¬ç«‹åœ°å¯¹å¾…æ¯ä¸ªåˆ†ç»„ï¼Œ**æ¯ä¸ªåˆ†ç»„ä¸å…¶ä»–åˆ†ç»„æ²¡æœ‰è”ç³»**ï¼Œæ¯ä¸ªåˆ†ç»„ä¸å…¶ä»–åˆ†ç»„æ²¡æœ‰è”ç³»ã€‚ä¸€ä¸ªæŠ¥æ–‡ï¼ˆä¼ è¾“å±‚æ¥çš„ï¼‰ä¸­åˆ†ç»„å¯èƒ½ä¼šæ²¿ç€ä¸åŒçš„è·¯å¾„åˆ°è¾¾å…¶ç›®çš„åœ°ã€‚

å› ç‰¹ç½‘ç½‘ç»œå±‚é€šä¿¡æ— è¿æ¥

> æ³¨:æ— è¿æ¥æ˜¯æŒ‡äº¤æ¢æœºæˆ–è·¯ç”±å™¨ä¸ä¿å­˜æœ‰å…³è¿æ¥çŠ¶æ€çš„ä¿¡æ¯ï¼Œä¸éœ€è¦å»º
> ç«‹è¿æ¥ï¼Œä¹Ÿä¸éœ€è¦æ‹†é™¤è¿æ¥ã€‚

> + å› ç‰¹ç½‘ä¸­çš„ç½‘ç»œå±‚äº¤æ¢æ˜¯åˆ©ç”¨æ•°æ®æŠ¥åˆ†ç»„äº¤æ¢çš„æ–¹æ³•å®ç°
> + åˆ†ç»„ä¼ é€’å¯åˆ©ç”¨é¢å‘è¿æ¥çš„æœåŠ¡æ¥å®ç°ï¼Œä¹Ÿå¯ä»¥åˆ©ç”¨æ— è¿æ¥æœåŠ¡å®ç°
> + å› ç‰¹ç½‘çš„ç½‘ç»œå±‚é€šä¿¡æ˜¯æ— è¿æ¥çš„

------

## IPv4

**ç½‘é™…åè®®ç¬¬å››ç‰ˆ**

TCP/IP

![](https://cdn.jsdelivr.net/gh/xinwuyun/pictures@main/2021/12/26/ad550495da0d0f62eb4dbfc305b983e7-image-20211226154745623-9eff5b.png)

+ IPv4æ˜¯TCP/IPåè®®ä¸­ä½¿ç”¨çš„ä¼ è¾“æœºåˆ¶ã€‚
+ IPv4æ˜¯ä¸€ç§ä¸å¯é çš„æ— è¿æ¥æ•°æ®æŠ¥åè®®â€”â€”å°½åŠ›ä¼ é€’ã€‚**å°½åŠ›ä¼ é€’è¿™ä¸€è¯æ˜¯æŒ‡IPv4åè®®ä¸æä¾›å·®é”™æ§åˆ¶æˆ–æµé‡æ§åˆ¶**
+ IPv4**å‡å®šåº•å±‚ä¸å¯é **
+ IPv4å¿…é¡»ä¸å¯é åè®®ï¼ˆå¦‚TCPç»“åˆä½¿ç”¨ï¼‰é…åˆ
+ IPv4ä¹Ÿæ˜¯ä½¿ç”¨æ•°æ®æŠ¥çš„åˆ†ç»„äº¤æ¢ç½‘çš„æ— è¿æ¥åè®®
  + æ¯ä¸€åˆ†ç»„ç‹¬ç«‹è¿›è¡Œå¤„ç†
  + æ¯ä¸€åˆ†ç§Ÿé€šè¿‡ä¸åŒè·¯ç”±ä¼ é€’åˆ°ç›®çš„ç«¯
  + æœ‰äº›æ•°æ®æŠ¥å¯èƒ½é—å¤±æˆ–æŸå

### æ•°æ®æŠ¥

IPv4å±‚çš„åˆ†ç»„ç§°ä¸º**æ•°æ®æŠ¥datagram**ã€‚

<img src="https://cdn.jsdelivr.net/gh/xinwuyun/pictures@main/2021/12/26/6b6b684b38935fcafb71446038a9c095-image-20211226160348148-882b86.png" alt="image-20211226160348148" style="zoom:60%;" /><img src="https://cdn.jsdelivr.net/gh/xinwuyun/pictures@main/2021/12/26/0193ffa2c95947e0291a40d8c9dbab2a-image-20211226160400766-b6d2bd.png" alt="image-20211226160400766" style="zoom:40%;" />

![image-20211226163522372](https://cdn.jsdelivr.net/gh/xinwuyun/pictures@main/2021/12/26/7501804a2f310f339eb76cf45a52ed4e-image-20211226163522372-2347b9.png)

#### VERç‰ˆæœ¬4ä½

å 4bitï¼ŒIPåè®®ç‰ˆæœ¬

0010

#### HLENé¦–éƒ¨é•¿åº¦4ä½

å•ä½é•¿åº¦4å­—èŠ‚ï¼Œå¤´éƒ¨æœ€å°å­—èŠ‚20ï¼Œä¸èƒ½å°äº5000000000

IPé¦–éƒ¨é•¿åº¦æœ€å¤§60å­—èŠ‚ï¼ˆ$15\times 4$ï¼‰

#### ServiceæœåŠ¡ç±»å‹8ä½

ç”¨æ¥è·å¾—æ›´å¥½çš„æœåŠ¡

![image-20211226161314603](/Users/xinwuyun/Library/Application Support/typora-user-images/image-20211226161314603.png)

![image-20211226161400114](https://cdn.jsdelivr.net/gh/xinwuyun/pictures@main/2021/12/26/10801c9f5cb81b0616a80544ac064dcf-image-20211226161400114-ba0375.png)

![image-20211226161522621](/Users/xinwuyun/Library/Application Support/typora-user-images/image-20211226161522621.png)

![image-20211226161543733](/Users/xinwuyun/Library/Application Support/typora-user-images/image-20211226161543733.png)

#### Total Lengthæ€»é•¿åº¦16å­—èŠ‚

é¦–éƒ¨å’Œæ•°æ®ä¹‹å’Œçš„é•¿åº¦ï¼Œå•ä½ä¸ºå­—èŠ‚ã€‚æ•°æ®æŠ¥æœ€å¤§é•¿åº¦ä¸º65535å­—èŠ‚ã€‚æ€»é•¿åº¦ä¸èƒ½è¶…è¿‡æœ€å¤§ä¼ é€å•å…ƒMTU



ä»¥å¤ªç½‘é™åˆ¶å¸§ä¸­æ•°æ®æŠ¥çš„é•¿åº¦åœ¨46åˆ°1500å­—èŠ‚ä¹‹é—´ï¼Œå½“æ•°æ®æŠ¥é•¿åº¦å°äº46å­—èŠ‚ï¼Œå¿…é¡»è¿›è¡Œå¡«å……(pading)

**æ•°æ®é•¿åº¦çš„è®¡ç®—æ–¹æ³•**

ä¸ºäº†æ‰¾åˆ°ä»ä¸Šå±‚æ¥çš„æ•°æ®é•¿åº¦ï¼Œå¯ä»¥å°†æ€»é•¿åº¦å‡å»å¤´éƒ¨é•¿åº¦ã€‚å°†HLENå­—æ®µçš„å€¼ä¹˜ä»¥4å°±å¯ä»¥å¾—åˆ°å¤´éƒ¨é•¿åº¦
$$
æ•°æ®é•¿åº¦=æ€»é•¿åº¦-å¤´éƒ¨é•¿åº¦
$$
è¿™ä¸ªå­—æ®µ16ä½é•¿ï¼Œå› æ­¤IPv4æ•°æ®æŠ¥é•¿åº¦é™åˆ¶åœ¨65535å­—èŠ‚ï¼Œå…¶ä¸­å¤´éƒ¨å 20åˆ°60å­—èŠ‚ï¼Œå‰©ä¸‹çš„æ˜¯ä»ä¸Šå±‚æ¥çš„æ•°æ®

> å®é™…ä¸ŠæŸäº›ç½‘ç»œä¸èƒ½å°†65535å­—èŠ‚çš„æ•°æ®æŠ¥å°è£…æˆä»–ä»¬çš„å¸§ï¼Œè¿™æ ·çš„è¯æ•°æ®æŠ¥å¿…é¡»åˆ†æ®µ
>
> è®¸å¤šæƒ…å†µä¸‹ï¼Œä¸ç”¨è¯»å–è¿™ä¸ªå­—æ®µï¼Œä½†æ˜¯æœ‰äº›æ—¶å€™å°è£…åœ¨ä¸€ä¸ªå¸§ä¸­çš„ä¸ä»…ä»…æ˜¯æ•°æ®æŠ¥ï¼Œè¿˜æœ‰**å¡«å……**ã€‚æ¯”å¦‚ï¼Œä»¥å¤ªç½‘é™åˆ¶æ•°æ®å­—æ®µå¤§å°ä¸º46~1500ï¼Œå¦‚æœæ•°æ®æŠ¥é•¿åº¦å°äº46å­—èŠ‚ï¼Œå¿…é¡»å¢åŠ å¡«å……å­—èŠ‚æ‰èƒ½ç¬¦åˆè¦æ±‚ã€‚
>
> ä¸€ä¸ªå°çš„æ•°æ®å°è£…åœ¨ä»¥å¤ªç½‘å¸§ä¸­
>
> ![image-20211226162700587](https://cdn.jsdelivr.net/gh/xinwuyun/pictures@main/2021/12/26/0b8606ffc3bd99a01d3ce99b7e849664-image-20211226162700587-13cb52.png)

#### æ ‡è¯†Identification 16ä½

æ˜¯ä¸€ä¸ªè®¡æ•°å™¨ï¼Œç”¨æ¥äº§ç”Ÿæ•°æ®æŠ¥çš„æ ‡è¯†ã€‚ç”¨äºåˆ†æ®µä¸­

#### æ ‡å¿—flag 3bit åªæœ‰æœ€åä¸¤ä½æœ‰æ„ä¹‰

![image-20211226165931051](https://cdn.jsdelivr.net/gh/xinwuyun/pictures@main/2021/12/26/97e6ecb9aa3a2dfb32769bb48fa23c86-image-20211226165931051-efd4ec.png)

![image-20211226170114604](https://cdn.jsdelivr.net/gh/xinwuyun/pictures@main/2021/12/26/bb829b930bb6b7caff872765866d616f-image-20211226170114604-13c1cb.png)

#### ç‰‡åç§»fragmentation offset13ä½

è¾ƒé•¿åˆ†ç»„åœ¨åˆ†ç‰‡åæŸç‰‡åœ¨åŸåˆ†ç»„ä¸­çš„ç›¸å¯¹ä½ç½®ï¼Œ8bitä¸ºåç§»å•ä½

#### ç”Ÿå­˜æ—¶é—´Time To Live 8bit

æ•°æ®æŠ¥å¯ä»¥åœ¨ç½‘ç»œä¸­é€šè¿‡è·¯ç”±å™¨çš„ä¸ªæ•°çš„æœ€å¤§å€¼

#### åè®®Protocol 8bit

åè®®(8 bit)å­—æ®µæŒ‡å‡ºæ­¤æ•°æ®æŠ¥æºå¸¦çš„æ•°æ®ä½¿ç”¨ä½•ç§åè®®ï¼Œ ä»¥ä¾¿ç›®çš„ä¸»æœºçš„ IP å±‚å°†æ•°æ®éƒ¨åˆ†ä¸Šäº¤ç»™é‚£ä¸ªå¤„ç†è¿‡ç¨‹ã€‚

![image-20211226171338926](https://cdn.jsdelivr.net/gh/xinwuyun/pictures@main/2021/12/26/0612834df5769747bf99ef093175f202-image-20211226171338926-aa5207.png)

![image-20211226171455352](https://cdn.jsdelivr.net/gh/xinwuyun/pictures@main/2021/12/26/211dbedcb983a4fc1d45de2d034e19d5-image-20211226171455352-36875e.png)

#### é¦–éƒ¨æ£€éªŒå’ŒChecksum

å€¼æ£€æµ‹é¦–éƒ¨ï¼Œä¸åŒ…æ‹¬æ•°æ®éƒ¨åˆ†ã€‚ä½¿ç”¨ç®€å•è®¡ç®—æ–¹æ³•

![image-20211226171600068](https://cdn.jsdelivr.net/gh/xinwuyun/pictures@main/2021/12/26/d5379fe057abe72aec22a3a3a2f3df43-image-20211226171600068-062c38.png)

![image-20211226172346990](https://cdn.jsdelivr.net/gh/xinwuyun/pictures@main/2021/12/26/a76fea2c8f043034d55d83d2a2b989aa-image-20211226172346990-43ddb9.png)

![image-20211226173019032](https://cdn.jsdelivr.net/gh/xinwuyun/pictures@main/2021/12/26/ea2e488360210feef424398b66013ea9-image-20211226173019032-bd8391.png)

### ä¾‹å­ğŸŒ°

#### ä¸€ä¸ªIPv4åˆ†ç»„çš„å‰8ä½å¦‚ä¸‹

01000010

å‰4ä½æ˜¯ç‰ˆæœ¬ï¼Œåå››ä½ä¸ºHLEN

ç‰ˆæœ¬æ­£ç¡®ã€‚åå››ä½æ˜¯2ï¼Œ$2\times {4}=8$å­—èŠ‚æ•°ä¸º8ï¼Œå¤´éƒ¨å­—èŠ‚æœ€å°å­—èŠ‚æ•°20ï¼Œæœ€å¤§60

#### HLEN

å¤´éƒ¨é•¿åº¦å­—æ®µçš„å€¼ä¸º1000ï¼Œé—®è¿™ä¸ªåˆ†ç»„æºå¸¦çš„é€‰é¡¹æ˜¯å‡ ä¸ªå­—èŠ‚ã€‚

ç­”ï¼š12å­—èŠ‚

#### è®¡ç®—æ•°æ®é•¿åº¦

IPv4åˆ†ç»„ï¼Œå¤´éƒ¨é•¿åº¦å­—æ®µçš„å€¼ä¸º5ï¼Œæ€»é•¿åº¦å­—æ®µçš„å€¼æ˜¯0x0028ï¼Œé—®è¿™ä¸ªåˆ†ç»„æºå¸¦çš„æ•°æ®æ˜¯å¤šå°‘å­—èŠ‚ï¼Ÿ
$$
32+8=40\\

40-20=20bytes
$$

```
|VER|HLEN|SERVICE     |   TOTAL_LENGTH   |
|    IDENTIFICATION   |FLAG|OFFSET       |
|TIME_TO_LIVE|PROTOCOL|HEADER_CHECKSUM   |
|Source IP Address                       |
|Destination IP Address                  |
```

#### TTL

0x45000028000100000102 . . .

01ï¼Œè¿˜èƒ½1è·³ã€‚

PROTOCOLæ˜¯02ï¼Œæ˜¯IGMP

## åˆ†æ®µ

+ ä¸€ä¸ªæ•°æ®æŠ¥å¯ä»¥é€šè¿‡å‡ ä¸ªä¸åŒçš„ç½‘ç»œè¿›è¡Œä¼ è¾“
+ æ¯ä¸ªè·¯ç”±å™¨å°†å®ƒæ‰€æ¥æ”¶åˆ°çš„å¸§æ‹†å°ç§°IPv4æ•°æ®æŠ¥ï¼Œå¯¹å…¶è¿›è¡Œå¤„ç†ï¼Œå†å°è£…æˆå¦ä¸€ä¸ªå¸§
+ æ¥æ”¶åˆ°å¸§çš„æ ¼å¼å’Œé•¿åº¦å–å†³äºæ­¤å¸§**åˆšåˆšç»è¿‡çš„**ç‰©ç†ç½‘ç»œæ‰€ä½¿ç”¨çš„åè®®
+ å‘å‡ºå»çš„å¸§çš„æ ¼å¼å’Œé•¿åº¦åˆ™å–å†³äº**å°†è¦ç»è¿‡çš„**ç‰©ç†ç½‘ç»œæ‰€ä½¿ç”¨çš„åè®®
+ ä¾‹å¦‚ï¼šå¦‚æœä¸€ä¸ªè·¯ç”±å™¨å°†ä¸€ä¸ªå±€åŸŸç½‘è¿æ¥åˆ°ä¸€ä¸ªå¹¿åŸŸç½‘
  + æ¥æ”¶åˆ°ï¼šå±€åŸŸç½‘å¸§
  + å‘é€ï¼šå¹¿åŸŸç½‘å¸§

### MTUæœ€å¤§ä¼ è¾“å•å…ƒ

æ¯ä¸ªæ•°æ®é“¾è·¯å±‚åè®®éƒ½æœ‰è‡ªå·±çš„å¸§æ ¼å¼ï¼Œè¿™æ ¼å¼å®šä¹‰çš„ä¸€ä¸ªå­—æ®µæ˜¯æ•°æ®å­—æ®µçš„æœ€å¤§é•¿åº¦ã€‚

å½“æ•°æ®æŠ¥å°è£…æˆå¸§æ—¶ï¼Œè¯¥æ•°æ®æŠ¥çš„æ€»é•¿åº¦å¿…é¡»å°äº**æœ€å¤§æ•°æ®é•¿åº¦**

![image-20211226203856936](https://cdn.jsdelivr.net/gh/xinwuyun/pictures@main/2021/12/26/b774aef2b2bb831bfe3aac58c72a52ec-image-20211226203856936-16fe29.png)

æŸäº›ç½‘ç»œçš„MTUå€¼

+ è¶…çº§é€šé“Hyperchannel: 65535
+ ä»¤ç‰Œç¯16Mbpsï¼š 17194
+ ä»¤ç‰Œç¯4Mbpsï¼š4464
+ FDDIï¼š4352
+ ä»¥å¤ªç½‘ï¼š1500
+ X.25ï¼š576
+ PPPï¼š296

æºç«¯é€šå¸¸ä¸å¯¹IPv4åˆ†ç»„è¿›è¡Œåˆ†æ®µï¼Œä¼ è¾“å±‚å°†æ•°æ®åˆ†å‰²æˆé€‚åˆåœ¨æ•°æ®é“¾è·¯å±‚æ‰€ç”¨IPv4çš„é•¿åº¦

å½“å¯¹ä¸€ä¸ªæ•°æ®æŠ¥è¿›è¡Œåˆ†æ®µæ—¶ï¼Œæ¯ä¸ªåˆ†æ®µéƒ½æœ‰å…¶è‡ªå·±çš„å¤´éƒ¨ï¼š

1. å¤´éƒ¨ä¸­çš„æŸäº›éƒ¨åˆ†éœ€è¦è¢«å¤åˆ¶åˆ°æ‰€æœ‰çš„åˆ†æ®µä¸­
2. ä¿®æ”¹ä¸‰ä¸ªå­—æ®µ
   1. æ ‡è¯†
   2. åˆ†æ®µåç§»
   3. æ€»é•¿åº¦

### ä¸åˆ†æ®µæœ‰å…³çš„å­—æ®µ

+ æ ‡è¯†identificationï¼šæ ‡è®°ä¸€ä¸ªä»æºä¸»æœºå‘å‡ºçš„æ•°æ®æŠ¥ï¼Œå”¯ä¸€å®šä¹‰è¿™ä¸ªæ•°æ®æŠ¥ã€‚

  + ä¸ºäº†ä¿è¯å”¯ä¸€æ€§ï¼ŒIPv4åè®®**ä½¿ç”¨ä¸€ä¸ªè®¡æ•°å™¨**æ ‡è¯†æ•°æ®æŠ¥
  + å‘é€æ•°æ®æŠ¥æ—¶ï¼Œå°±å°†è¯¥è®¡æ•°å™¨çš„å€¼**å¤åˆ¶åˆ°æ ‡è¯†å­—æ®µ**ä¸­
  + åªè¦è¯¥è®¡æ•°å™¨ä¿å­˜åœ¨ä¸»å­˜ä¸­ï¼Œå”¯ä¸€æ€§å°±å¾—åˆ°ä¿è¯
  + æ‰€æœ‰åˆ†æ®µè¯¥å­—æ®µç›¸åŒ
  + ç›®çš„ç«¯æ®æ­¤è¿›è¡Œé‡ç»„

+ æ ‡è®°flag

  + Reserved
  + Dont fragment
    + 1ä¸åˆ†æ®µï¼šå¦‚æœé€šä¸è¿‡è¯¥ç½‘ç»œï¼Œåˆ™ä¸¢å¼ƒå¹¶å‘æºä¸»æœºå‘é€ä¸€ä¸ªICMPå·®é”™æŠ¥æ–‡
    + 0ï¼Œæ ¹æ®éœ€è¦å¯¹æ•°æ®æŠ¥è¿›è¡Œåˆ†æ®µ
  + More fragmentï¼šå¤šåˆ†ä½æ®µ
    + 1ï¼šè¡¨æ˜ä¸æ˜¯æœ€åçš„åˆ†æ®µ
    + 0ï¼šæ˜¯æœ€åçš„åˆ†æ®µæˆ–å”¯ä¸€åˆ†æ®µ

+ åˆ†æ®µåç§»

  + è¡¨ç¤ºè¿™ä¸ªåˆ†æ®µåœ¨æ•´ä¸ªæ•°æ®æŠ¥ä¸­çš„ç›¸å¯¹ä½ç½®
  + 8å­—èŠ‚ä¸ºåº¦é‡å•ä½

  ![image-20211226210914387](https://cdn.jsdelivr.net/gh/xinwuyun/pictures@main/2021/12/26/4fd7832eb63ae2dd9916f895a9019ad0-image-20211226210914387-db572a.png)





## æ ¡éªŒå’Œ

![image-20211226220108055](/Users/xinwuyun/Library/Application Support/typora-user-images/image-20211226220108055.png)

![image-20211226220201771](https://cdn.jsdelivr.net/gh/xinwuyun/pictures@main/2021/12/26/7abfcd850734abc4549c39a0492da6cd-image-20211226220201771-c477dc.png)

## IPv6

+ åœ°å€ç©ºé—´æ›´å¤§
+ **å±‚æ¬¡ç»“æ„**æ‰©å±•æ€§å¼º
+ é¦–éƒ¨æ ¼å¼çµæ´»
+ æ”¹è¿›çš„é€‰é¡¹
+ å…è®¸åè®®ç»§ç»­æ‰©ç§
+ æ”¯æŒå³æ’å³ç”¨
+ æ”¯æŒèµ„æºçš„é¢„åˆ†é…
+ æ”¯æŒæ›´å¤šçš„å®‰å…¨æ€§
+ é¦–éƒ¨æ”¹ä¸º8å­—èŠ‚å¯¹é½

### IPv6æ•°æ®æŠ¥å¤´éƒ¨å’Œæœ‰æ•ˆè½½è·

![image-20211226220432836](https://cdn.jsdelivr.net/gh/xinwuyun/pictures@main/2021/12/26/ad31ef9e1890c2de23766f2d1bec1f81-image-20211226220432836-28246c.png)

![image-20211226220515511](https://cdn.jsdelivr.net/gh/xinwuyun/pictures@main/2021/12/26/a56cb7092af58a708d1f60d382cedc5f-image-20211226220515511-7677ad.png)

#### ç‰ˆæœ¬Version 4bit Version

0110

#### ä¼˜å…ˆçº§ 4bit Traffic Class

å‘ç”Ÿé€šä¿¡é‡æ‹¥å¡æ—¶åˆ†ç»„çš„ä¼˜å…ˆçº§

+ å¯è¿›è¡Œæ‹¥å¡æ§åˆ¶çš„é€šä¿¡é‡
+ ä¸å¯è¿›è¡Œæ‹¥å¡æ§åˆ¶çš„é€šä¿¡é‡

#### æµæ ‡å· 24bit Flow Label

æµæ˜¯äº’è”ç½‘ç»œä¸Šä»ç‰¹å®šæºç‚¹åˆ°ç‰¹å®šç»ˆç‚¹çš„ä¸€ç³»åˆ—æ•°æ®æŠ¥ï¼Œâ€œæµâ€æ‰€ç»è¿‡çš„è·¯å¾„ä¸Šçš„è·¯ç”±å™¨éƒ½ä¿è¯æŒ‡æ˜çš„æœåŠ¡è´¨é‡ã€‚æ‰€æœ‰å±äºåŒä¸€ä¸ªæµçš„æ•°æ®æŠ¥éƒ½å…·æœ‰åŒæ ·çš„æµæ ‡å·

#### æœ‰æ•ˆè½½è·é•¿åº¦ Payload length 16bit

æŒ‡æ˜IPv6æ•°æ®æŠ¥é™¤**åŸºæœ¬é¦–éƒ¨**ä»¥å¤–çš„å­—èŠ‚æ•°

#### ä¸‹ä¸€ä¸ªé¦–éƒ¨ next header

8bit ç›¸å½“äºIPv4çš„protocolæˆ–å¯é€‰å­—æ®µ

#### è·³æ•°æ§åˆ¶ hop limit

è·³æ•°é™åˆ¶

#### æ•°æ®æŠ¥æ ¼å¼

![image-20211226221458833](https://cdn.jsdelivr.net/gh/xinwuyun/pictures@main/2021/12/26/2c7d1e2d63b9769dc83a86f88b15a813-image-20211226221458833-b8b494.png)

## 

![image-20211226222422630](/Users/xinwuyun/Library/Application Support/typora-user-images/image-20211226222422630.png)



## 4to6è¿‡æ¸¡

å› ç‰¹ç½‘ä¸Šç³»ç»Ÿéå¸¸å¤šï¼Œä»IPv4åˆ°IPv6çš„è¿‡æ¸¡ä¸èƒ½çªç„¶å‘ç”Ÿã€‚è¦ä½¿æ¯ä¸€ä¸ªç³»ç»Ÿä»IPv4è¿‡æ¸¡åˆ°IPv6ï¼Œéœ€è¦èŠ±è´¹ç›¸å½“é•¿çš„æ—¶é—´ï¼Œ

### ä¸‰ç§è¿‡æ¸¡ç­–ç•¥

+ åŒåè®®æ ˆ
+ éš§é“æŠ€æœ¯
+ å¤´éƒ¨è½¬æ¢

## è¿‡æ¸¡.åŒåè®®æ ˆ

+ è¿‡æ¸¡åˆ°v6ä¹‹å‰ï¼Œä½¿ç”¨**åŒåè®®æ ˆdual stack**
+ åˆ†ç»„å‘é€åˆ°ç›®çš„ç«¯æ—¶
+ ä¸»æœºå‘DNSæŸ¥è¯¢ï¼Œ
+ å¦‚æœè¿”å›ä¸€ä¸ªIPv4åœ°å€ï¼Œæºä¸»æœºå°±å‘é€IPv4åˆ†ç»„ï¼Œ
+ å¦‚æœè¿”å›IPv6åˆ†ç»„ï¼Œå°±å‘é€ä¸€ä¸ªIPv6åˆ†ç»„

## è¿‡æ¸¡.éš§é“æŠ€æœ¯

å½“ä¸¤å°ä½¿ç”¨IPv6è®¡ç®—æœºäº’ç›¸é€šä¿¡ï¼Œé€šè¿‡Ipv4åŒºåŸŸæ—¶ï¼Œä½¿ç”¨éš§é“æŠ€æœ¯ã€‚

è¿›å…¥æ—¶å°è£…æˆ4åˆ†ç»„ï¼Œç¦»å¼€æ—¶å»æ‰å°è£…

![image-20211226223845288](https://cdn.jsdelivr.net/gh/xinwuyun/pictures@main/2021/12/26/094e9d779368e209f323d30b7f9413df-image-20211226223845288-d6212f.png)

## å¤´éƒ¨è½¬æ¢

![image-20211226224015735](https://cdn.jsdelivr.net/gh/xinwuyun/pictures@main/2021/12/26/af2be377dffe15bda3b5c897085bfaa8-image-20211226224015735-48c5c3.png)

![image-20211226224037248](https://cdn.jsdelivr.net/gh/xinwuyun/pictures@main/2021/12/26/80b735288bc3aade4658f83e3f3e9adb-image-20211226224037248-6b71f3.png)

![image-20211226224049030](https://cdn.jsdelivr.net/gh/xinwuyun/pictures@main/2021/12/26/74c453227e994f9e34915167770d9c3c-image-20211226224049030-e6ac0b.png)

![image-20211226224339473](https://cdn.jsdelivr.net/gh/xinwuyun/pictures@main/2021/12/26/2da43105f765bdb4c5ae1da99660a2c7-image-20211226224339473-bca1ad.png)

![image-20211226224346756](https://cdn.jsdelivr.net/gh/xinwuyun/pictures@main/2021/12/26/3db2a9141d004dace6938eb6f1db2ae4-image-20211226224346756-78e5a9.png)

0x45 00 00 54 00 03 00 00 20 06 58 41 7C 4E 03 02 B4 0E 0F 02







